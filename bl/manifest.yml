type: update
name: load balancer
baseUrl: http://gitlab.hidora.com/softozor/hasura-jps/-/raw/master

targetNodes:
  nodeGroup:
    - bl

settings:
  fields:
    - name: externalDomains
      caption: External domain names (;-separated list)
      type: string
      required: true

onInstall:
  - installAddon:
      id: letsencrypt
  - redirectHttpToHttps
  - restartContainers[bl]

actions:
  redirectHttpToHttps:
    - cmd [bl]:
        - wget ${baseUrl}/bl/nginx-jelastic.conf -O /etc/nginx/nginx-jelastic.conf
      user: root

addons:
  - id: letsencrypt
    name: letsencrypt
    onInstall:
      - install [bl]:
          envName: ${env.envName}
          jps: https://github.com/jelastic-jps/lets-encrypt/blob/master/manifest.jps
          settings:
            customDomains: ${settings.externalDomains}